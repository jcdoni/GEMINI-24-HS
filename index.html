<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEMINI GLOBAL HUB | V21 PRO</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --p: #00ff88; --bg: #000; --s: #111; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: sans-serif; overflow: hidden; display: flex; height: 100vh; }
        
        /* Interface Est√°tica - Carrega sempre */
        .sidebar { width: 70px; background: #050505; border-right: 1px solid #222; display: flex; flex-direction: column; align-items: center; padding-top: 20px; }
        .main { flex: 1; display: flex; flex-direction: column; background: radial-gradient(circle at top right, #0d1a14, #000); }
        .header { padding: 20px; border-bottom: 1px solid #1a1a1a; display: flex; justify-content: space-between; align-items: center; }
        
        /* Grid Otimizado */
        #render-area { flex: 1; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; padding: 20px; }
        .card { background: var(--s); border-radius: 10px; overflow: hidden; border: 2px solid transparent; cursor: pointer; transition: 0.3s; position: relative; aspect-ratio: 16/9; }
        .card:hover { border-color: var(--p); transform: scale(1.05); }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .card-t { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8); font-size: 10px; padding: 5px; text-align: center; font-weight: bold; }

        /* Modais */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 999; }
        .modal { background: #080808; padding: 30px; border-radius: 15px; border: 1px solid var(--p); width: 320px; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 5px; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; background: var(--p); border: none; font-weight: bold; cursor: pointer; border-radius: 5px; }

        /* Player */
        #p-ui { position: fixed; inset: 0; background: #000; z-index: 1000; display: none; }
        video { width: 100%; height: 100%; }
        .close { position: absolute; top: 20px; left: 20px; background: var(--p); color: #000; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; z-index: 1001; }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div style="cursor:pointer; font-size: 24px;" onclick="location.reload()">üè†</div>
        <div style="cursor:pointer; font-size: 24px; margin-top:30px;" onclick="openM()">‚öôÔ∏è</div>
    </nav>

    <div class="main">
        <div class="header">
            <h2 style="color:var(--p); margin:0;">GEMINI GLOBAL <span style="color:#fff; font-size:12px;">V21</span></h2>
            <div id="stats" style="font-size:10px; opacity:0.5;">SISTEMA PRONTO</div>
        </div>
        <div id="render-area">
            </div>
    </div>

    <div class="overlay" id="m-ui">
        <div class="modal">
            <h3 style="margin-top:0">CONECTAR FONTE</h3>
            <input type="text" id="h" placeholder="Host (http://url.com:8080)">
            <input type="text" id="u" placeholder="Usu√°rio">
            <input type="password" id="s" placeholder="Senha">
            <p style="text-align:center; font-size:10px;">OU</p>
            <input type="text" id="m" placeholder="Link M3U">
            <button class="btn" onclick="load()">SINCRONIZAR</button>
            <button class="btn" style="background:#222; color:#fff; margin-top:5px;" onclick="closeM()">FECHAR</button>
        </div>
    </div>

    <div id="p-ui">
        <div class="close" onclick="closeP()">SAIR</div>
        <video id="v" controls></video>
    </div>

    <script>
        let DATA = [];
        try { DATA = JSON.parse(localStorage.getItem('g_v21')) || []; } catch(e) { localStorage.clear(); }

        window.onload = () => { if(DATA.length > 0) render(); else openM(); };

        function openM() { document.getElementById('m-ui').style.display = 'flex'; }
        function closeM() { document.getElementById('m-ui').style.display = 'none'; }

        async function load() {
            const stats = document.getElementById('stats');
            stats.innerText = "CONECTANDO...";
            const host = document.getElementById('h').value.trim();
            const user = document.getElementById('u').value.trim();
            const pass = document.getElementById('s').value.trim();
            const m3u = document.getElementById('m').value.trim();
            const proxy = "https://api.allorigins.win/raw?url=";

            try {
                let list = [];
                if(host && user && pass) {
                    const url = `${host}/player_api.php?username=${user}&password=${pass}&action=get_live_streams`;
                    const r = await fetch(proxy + encodeURIComponent(url));
                    const d = await r.json();
                    list = d.map(i => ({ n: i.name, l: i.stream_icon, u: `${host}/${user}/${pass}/${i.stream_id}.ts` }));
                } else if(m3u) {
                    const r = await fetch(proxy + encodeURIComponent(m3u));
                    const t = await r.text();
                    const lines = t.split('\n');
                    for(let i=0; i<lines.length; i++) {
                        if(lines[i].includes("#EXTINF")) {
                            const name = lines[i].split(',')[1] || "Canal";
                            const logo = lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || "";
                            const url = lines[i+1]?.trim();
                            if(url) list.push({ n: name, l: logo, u: url });
                        }
                    }
                }
                
                // Salva apenas os primeiros 5000 para n√£o quebrar o navegador
                DATA = list.slice(0, 5000);
                localStorage.setItem('g_v21', JSON.stringify(DATA));
                render();
                stats.innerText = DATA.length + " CANAIS OK";
                closeM();
            } catch(e) { 
                alert("Erro de conex√£o. Verifique os dados ou o Host."); 
                stats.innerText = "ERRO NA LISTA";
            }
        }

        function render() {
            const area = document.getElementById('render-area');
            // Renderiza 200 por vez para performance
            area.innerHTML = DATA.slice(0, 200).map(i => `
                <div class="card" onclick="play('${i.u}')">
                    <img src="${i.l}" loading="lazy" onerror="this.src='https://via.placeholder.com/200x110/111/00ff88?text=TV'">
                    <div class="card-t">${i.n}</div>
                </div>
            `).join('');
        }

        function play(url) {
            const ui = document.getElementById('p-ui');
            const v = document.getElementById('v');
            ui.style.display = 'block';
            if(Hls.isSupported()) {
                const hls = new Hls(); hls.loadSource(url); hls.attachMedia(v);
                hls.on(Hls.Events.MANIFEST_PARSED, () => v.play());
            } else { v.src = url; v.play(); }
        }

        function closeP() {
            const v = document.getElementById('v');
            v.pause(); v.src = "";
            document.getElementById('p-ui').style.display = 'none';
        }
    </script>
</body>
</html>
