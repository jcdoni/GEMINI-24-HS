<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini TV v8.3 | Enterprise Playlist Management</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        fire: {
                            blue: '#00a8e1',
                            dark: '#00050d',
                            panel: '#0a111f',
                            border: 'rgba(255,255,255,0.08)'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        * { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        body { background-color: #00050d; color: #e2e8f0; overflow-x: hidden; }
        
        /* SCROLLBAR GOURMET */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #00050d; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #00a8e1; }

        /* GLASS EFFECTS */
        .glass-nav { background: rgba(0, 5, 13, 0.9); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .fire-gradient { background: linear-gradient(135deg, #00a8e1 0%, #005f7a 100%); }
        
        /* ANIMATIONS (SCROLL REVEAL) */
        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s ease-out; }
        .reveal.active { opacity: 1; transform: translateY(0); }

        /* PRICING TABLE STYLES */
        .price-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid rgba(255,255,255,0.05); }
        .price-card:hover { transform: translateY(-10px); border-color: #00a8e1; box-shadow: 0 20px 40px rgba(0, 168, 225, 0.1); }
        .check-icon { color: #00a8e1; font-weight: 900; }

        /* EDITOR WORKSPACE */
        .editor-grid { display: grid; grid-template-columns: 280px 1fr 320px; height: calc(100vh - 64px); }
        .panel-left { background: #020812; border-right: 1px solid rgba(255,255,255,0.05); }
        .panel-center { background: #00050d; overflow-y: auto; }
        .panel-right { background: #050a14; border-left: 1px solid rgba(255,255,255,0.05); }

        /* TABLES */
        .iptv-table th { background: #050a14; color: #64748b; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; padding: 12px; position: sticky; top: 0; z-index: 10; }
        .iptv-table td { padding: 10px 12px; border-bottom: 1px solid rgba(255,255,255,0.02); font-size: 13px; }
        .iptv-table tr:hover { background: rgba(0, 168, 225, 0.05); cursor: pointer; }
        
        .active-row { background: rgba(0, 168, 225, 0.15) !important; border-left: 3px solid #00a8e1; }

        /* CUSTOM BUTTONS */
        .btn-main { background: #00a8e1; color: white; padding: 12px 24px; border-radius: 8px; font-weight: 700; transition: all 0.2s; }
        .btn-main:hover { background: #008fbf; transform: scale(1.02); }
    </style>
</head>
<body class="dark">

    <div id="app-root">
        
        <header class="glass-nav fixed w-full top-0 z-[100] h-16 flex items-center justify-between px-8">
            <div class="flex items-center gap-12">
                <div class="text-2xl font-black tracking-tighter cursor-pointer" onclick="Router.go('landing')">
                    <span class="text-white">GEMINI</span><span class="text-fire-blue">TV</span>
                </div>
                <nav class="hidden md:flex gap-8 text-sm font-bold text-gray-400 uppercase tracking-widest">
                    <button onclick="Router.go('landing')" class="hover:text-white transition-colors">Home</button>
                    <button class="hover:text-white transition-colors">FAQ & Guides</button>
                    <button class="hover:text-white transition-colors">Support</button>
                    <button onclick="Router.go('playlists')" class="hover:text-white transition-colors">My Account</button>
                </nav>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="Router.go('playlists')" class="bg-fire-blue/10 border border-fire-blue/30 text-fire-blue px-6 py-2 rounded-full font-bold text-xs hover:bg-fire-blue hover:text-white transition-all">MY ACCOUNT</button>
            </div>
        </header>

        <div id="view-landing" class="pt-16">
            
            <section class="min-h-[80vh] flex flex-col items-center justify-center text-center px-4 relative overflow-hidden">
                <div class="absolute w-[500px] h-[500px] bg-fire-blue/10 blur-[120px] rounded-full -top-40 -left-20"></div>
                <div class="reveal active">
                    <h1 class="text-5xl md:text-7xl font-black mb-6 tracking-tight leading-tight">
                        Your playlists, <span class="text-fire-blue">made easier</span>
                    </h1>
                    <p class="text-xl text-gray-500 max-w-2xl mx-auto mb-10">
                        Manage your playlists in one place with wide EPG coverage and updated images ready to use.
                    </p>
                    <div class="flex gap-4 justify-center">
                        <button onclick="Router.go('playlists')" class="btn-main px-10 py-4 text-lg">GET STARTED NOW</button>
                        <button class="bg-white/5 border border-white/10 px-10 py-4 rounded-lg font-bold hover:bg-white/10">VIEW FEATURES</button>
                    </div>
                </div>
            </section>

            <section class="py-24 bg-black/30">
                <div class="max-w-7xl mx-auto px-8">
                    <div class="text-center mb-16 reveal">
                        <span class="text-fire-blue font-black text-xs uppercase tracking-[0.3em]">Designed for Users</span>
                        <h2 class="text-4xl font-black mt-4">Core features</h2>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-fire-panel p-10 rounded-3xl border border-white/5 reveal">
                            <div class="w-14 h-14 bg-fire-blue/20 rounded-2xl flex items-center justify-center mb-6">
                                <i class="fa-solid fa-layer-group text-2xl text-fire-blue"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-4">Wide compatibility</h3>
                            <p class="text-gray-500 leading-relaxed text-sm">
                                Need to work with different playlist formats? No problem. IPTVEditor supports all major formats for both import and export.
                            </p>
                        </div>
                        <div class="bg-fire-panel p-10 rounded-3xl border border-white/5 reveal" style="transition-delay: 0.1s">
                            <div class="w-14 h-14 bg-fire-blue/20 rounded-2xl flex items-center justify-center mb-6">
                                <i class="fa-solid fa-cloud text-2xl text-fire-blue"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-4">Cloud computing tech</h3>
                            <p class="text-gray-500 leading-relaxed text-sm">
                                Keep your playlists always with you. You can save up to 40 playlists on our dedicated Cloud space.
                            </p>
                        </div>
                        <div class="bg-fire-panel p-10 rounded-3xl border border-white/5 reveal" style="transition-delay: 0.2s">
                            <div class="w-14 h-14 bg-fire-blue/20 rounded-2xl flex items-center justify-center mb-6">
                                <i class="fa-solid fa-bolt text-2xl text-fire-blue"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-4">User friendly</h3>
                            <p class="text-gray-500 leading-relaxed text-sm">
                                No software to download, no compatibility issues. All you need is your screen and internet connection.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="py-24 max-w-7xl mx-auto px-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-20 items-center">
                    <div class="reveal">
                        <h2 class="text-5xl font-black mb-8 leading-tight">All your playlists customized in <span class="text-fire-blue">one click</span></h2>
                        <p class="text-gray-400 text-lg mb-8">Stop wasting time manually linking logos and EPG data to your playlist.</p>
                        
                        <div class="space-y-6">
                            <div class="flex gap-6 items-start">
                                <div class="text-fire-blue text-2xl pt-1"><i class="fa-solid fa-circle-check"></i></div>
                                <div>
                                    <h4 class="font-bold text-white mb-2">Automatic logo search</h4>
                                    <p class="text-gray-500 text-sm">Automatically assign logos from our curated icon library or match them from the web.</p>
                                </div>
                            </div>
                            <div class="flex gap-6 items-start">
                                <div class="text-fire-blue text-2xl pt-1"><i class="fa-solid fa-circle-check"></i></div>
                                <div>
                                    <h4 class="font-bold text-white mb-2">Automatic EPG search</h4>
                                    <p class="text-gray-500 text-sm">Let IPTVEditor automatically connect the right EPG data to your playlist channels.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-fire-panel rounded-3xl p-4 border border-white/10 shadow-2xl reveal">
                         <img src="https://iptveditor.com/assets/img/screens/editor.jpg" class="rounded-2xl opacity-80" alt="Preview">
                    </div>
                </div>
            </section>

            <section class="py-24 bg-black/50">
                <div class="max-w-6xl mx-auto px-8">
                    <div class="text-center mb-16 reveal">
                        <span class="text-fire-blue font-black text-xs uppercase tracking-[0.3em]">Our Pricing</span>
                        <h2 class="text-4xl font-black mt-4">Affordable Pricing Plans</h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                        <div class="price-card bg-fire-panel rounded-[2rem] p-10 flex flex-col reveal">
                            <span class="text-fire-blue font-black text-[10px] uppercase mb-4">Recommended</span>
                            <h3 class="text-3xl font-black mb-2">Advanced</h3>
                            <div class="text-5xl font-black mb-8">€14.90 <span class="text-sm text-gray-500 font-normal">/ year</span></div>
                            
                            <ul class="space-y-4 mb-10 flex-1">
                                <li class="flex items-center gap-3 text-sm"><i class="fa-solid fa-check check-icon"></i> Max playlists: <b>up to 40</b></li>
                                <li class="flex items-center gap-3 text-sm"><i class="fa-solid fa-check check-icon"></i> Entries: <b>up to 1 million</b></li>
                                <li class="flex items-center gap-3 text-sm"><i class="fa-solid fa-check check-icon"></i> EPG sources: <b>up to ∞</b></li>
                                <li class="flex items-center gap-3 text-sm"><i class="fa-solid fa-check check-icon"></i> Auto updater daily syncs: <b>~ 10</b></li>
                                <li class="flex items-center gap-3 text-sm"><i class="fa-solid fa-check check-icon"></i> Stalker Portal (MAG): <b>✓</b></li>
                                <li class="flex items-center gap-3 text-sm"><i class="fa-solid fa-check check-icon"></i> Web Player: <b>✓</b></li>
                            </ul>
                            <button class="btn-main w-full py-4 text-sm tracking-widest uppercase">Purchase Now</button>
                        </div>

                        <div class="price-card bg-fire-panel rounded-[2rem] p-10 flex flex-col reveal">
                            <span class="text-gray-500 font-black text-[10px] uppercase mb-4">Lite Version</span>
                            <h3 class="text-3xl font-black mb-2">Basic</h3>
                            <div class="text-5xl font-black mb-8">€9.90 <span class="text-sm text-gray-500 font-normal">/ year</span></div>
                            
                            <ul class="space-y-4 mb-10 flex-1">
                                <li class="flex items-center gap-3 text-sm"><i class="fa-solid fa-check check-icon"></i> Max playlists: <b>3</b></li>
                                <li class="flex items-center gap-3 text-sm"><i class="fa-solid fa-check check-icon"></i> Entries: <b>up to 100,000</b></li>
                                <li class="flex items-center gap-3 text-sm text-gray-600"><i class="fa-solid fa-xmark text-red-500"></i> EPG sources: <b>0</b></li>
                                <li class="flex items-center gap-3 text-sm"><i class="fa-solid fa-check check-icon"></i> Auto updater daily syncs: <b>~ 10</b></li>
                                <li class="flex items-center gap-3 text-sm"><i class="fa-solid fa-check check-icon"></i> Stalker Portal (MAG): <b>✓</b></li>
                                <li class="flex items-center gap-3 text-sm"><i class="fa-solid fa-check check-icon"></i> Web Player: <b>✓</b></li>
                            </ul>
                            <button class="bg-white/5 border border-white/10 w-full py-4 rounded-lg font-bold text-sm tracking-widest uppercase hover:bg-white/10">Purchase Now</button>
                        </div>
                    </div>
                </div>
            </section>

            <footer class="py-20 border-t border-white/5">
                <div class="max-w-7xl mx-auto px-8 grid grid-cols-2 md:grid-cols-4 gap-12">
                    <div>
                        <div class="text-xl font-black mb-6">GEMINI TV</div>
                        <p class="text-xs text-gray-600 leading-relaxed">© 2019 - 2026, IPTVEditor.com Clone Engine. Enterprise Tool for Playlist Managers.</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-sm mb-6 uppercase tracking-widest">General</h4>
                        <ul class="text-xs text-gray-500 space-y-4">
                            <li>Home</li>
                            <li>FAQ & Guides</li>
                            <li>My Account</li>
                            <li>My Orders</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-sm mb-6 uppercase tracking-widest">Support</h4>
                        <ul class="text-xs text-gray-500 space-y-4">
                            <li>Open a ticket</li>
                            <li>Contact us</li>
                            <li>Maintenance Status</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-bold text-sm mb-6 uppercase tracking-widest">Legal</h4>
                        <ul class="text-xs text-gray-500 space-y-4">
                            <li>Terms & Conditions</li>
                            <li>Privacy Policy</li>
                        </ul>
                    </div>
                </div>
            </footer>
        </div>

        <div id="view-playlists" class="pt-16 hidden min-h-screen">
            <div class="max-w-7xl mx-auto p-12">
                <div class="flex justify-between items-end mb-12">
                    <div>
                        <h2 class="text-4xl font-black">My Playlists</h2>
                        <p class="text-gray-500 mt-2">Manage your M3U and Xtream sources.</p>
                    </div>
                    <button onclick="IO.importPrompt()" class="btn-main flex items-center gap-2">
                        <i class="fa-solid fa-plus"></i> NEW PLAYLIST
                    </button>
                </div>

                <div class="bg-fire-panel border border-white/5 rounded-3xl overflow-hidden shadow-2xl">
                    <table class="w-full iptv-table text-left">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Channels</th>
                                <th>Groups</th>
                                <th>Auto-Sync</th>
                                <th>Expiration</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="pl-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="view-editor" class="pt-16 hidden">
            <div class="h-14 bg-fire-panel border-b border-white/5 flex items-center justify-between px-6">
                <div class="flex items-center gap-6">
                    <span id="active-pl-name" class="font-black text-fire-blue text-xs uppercase tracking-widest">Playlist: </span>
                    <div class="h-6 w-px bg-white/10"></div>
                    <div class="flex items-center gap-2">
                        <button class="bg-black/40 px-4 py-1.5 rounded text-[10px] font-black border border-fire-blue text-fire-blue">LIVE CHANNELS</button>
                        <button class="bg-black/20 px-4 py-1.5 rounded text-[10px] font-black text-gray-600 hover:text-white transition-all">VOD / MOVIES</button>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="relative">
                        <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-600 text-[10px]"></i>
                        <input type="text" id="ch-search" onkeyup="Editor.renderChannels()" placeholder="Search channels..." class="bg-black/40 border border-white/10 rounded-full pl-8 pr-4 py-1.5 text-[10px] text-white focus:border-fire-blue outline-none w-64">
                    </div>
                    <button onclick="Editor.openBulkTools()" class="bg-fire-blue/10 text-fire-blue border border-fire-blue/20 px-4 py-1.5 rounded text-[10px] font-black uppercase tracking-widest">More Tools</button>
                </div>
            </div>

            <div class="editor-grid">
                <aside class="panel-left flex flex-col">
                    <div class="p-4 border-b border-white/5 flex justify-between items-center text-[10px] font-black text-gray-500 uppercase tracking-widest">
                        <span>Groups</span>
                        <span id="count-groups" class="text-fire-blue bg-fire-blue/10 px-2 py-0.5 rounded-full">0</span>
                    </div>
                    <div id="list-groups" class="flex-1 overflow-y-auto p-2 space-y-1">
                        </div>
                </aside>

                <main class="panel-center flex flex-col">
                    <table class="w-full iptv-table">
                        <thead>
                            <tr>
                                <th class="w-8"><input type="checkbox" id="master-select" onclick="Editor.selectAll()"></th>
                                <th class="w-12">Logo</th>
                                <th>Channel Name</th>
                                <th>EPG ID</th>
                                <th class="w-10">#</th>
                            </tr>
                        </thead>
                        <tbody id="list-channels">
                            </tbody>
                    </table>
                </main>

                <aside class="panel-right p-6 overflow-y-auto">
                    <h3 class="text-[10px] font-black text-fire-blue uppercase tracking-[0.2em] mb-8">Properties</h3>
                    
                    <div id="empty-state-prop" class="text-center py-20 opacity-20">
                        <i class="fa-solid fa-mouse-pointer text-4xl mb-4"></i>
                        <p class="text-xs font-bold">SELECT A CHANNEL</p>
                    </div>

                    <div id="prop-form" class="hidden space-y-6">
                        <div>
                            <label class="text-[9px] font-black text-gray-500 uppercase mb-2 block">Display Name</label>
                            <input type="text" id="attr-name" class="w-full bg-black/40 border border-white/5 p-3 rounded-xl text-sm focus:border-fire-blue outline-none">
                        </div>
                        <div>
                            <label class="text-[9px] font-black text-gray-500 uppercase mb-2 block">Logo URL</label>
                            <div class="flex gap-2">
                                <input type="text" id="attr-logo" class="flex-1 bg-black/40 border border-white/5 p-3 rounded-xl text-sm focus:border-fire-blue outline-none">
                                <div id="logo-preview" class="w-12 h-12 bg-black rounded-lg border border-white/5 flex items-center justify-center overflow-hidden shrink-0">
                                    <i class="fa-solid fa-image text-gray-800"></i>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="text-[9px] font-black text-gray-500 uppercase mb-2 block">EPG Mapping</label>
                            <input type="text" id="attr-epg" class="w-full bg-black/40 border border-white/5 p-3 rounded-xl text-sm focus:border-fire-blue outline-none">
                        </div>
                        <div>
                            <label class="text-[9px] font-black text-gray-500 uppercase mb-2 block">Stream URL (Read-only)</label>
                            <input type="text" id="attr-url" readonly class="w-full bg-black/20 border border-white/5 p-3 rounded-xl text-xs text-gray-600 outline-none font-mono">
                        </div>
                        
                        <div class="pt-6">
                            <button onclick="Editor.saveChanges()" class="btn-main w-full py-4 text-xs tracking-widest uppercase">Save Attributes</button>
                        </div>
                    </div>
                </aside>
            </div>
        </div>

    </div>

    <div id="modal-overlay" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[200] hidden flex items-center justify-center p-6">
        <div class="bg-fire-panel border border-white/10 w-full max-w-lg rounded-[2rem] p-10 shadow-2xl">
            <h2 id="modal-title" class="text-2xl font-black mb-6">Import</h2>
            <div id="modal-body" class="mb-10"></div>
            <div class="flex justify-end gap-6">
                <button onclick="UI.closeModal()" class="text-gray-500 font-bold hover:text-white">CANCEL</button>
                <button id="modal-confirm" class="btn-main px-8">PROCEED</button>
            </div>
        </div>
    </div>

    <div id="toast-container" class="fixed bottom-10 right-10 z-[300] flex flex-col gap-4"></div>

    <script>
        // --- DATA & STATE ---
        const AppState = {
            playlists: [],
            currentPL: null,
            currentGroup: null,
            editingChannel: null,
            selectedChannels: new Set()
        };

        // --- DATABASE (INDEXEDDB) ---
        const DB = {
            instance: null,
            init() {
                const req = indexedDB.open("GeminiTV_PRO_v8", 1);
                req.onupgradeneeded = e => {
                    const db = e.target.result;
                    if(!db.objectStoreNames.contains('playlists')) db.createObjectStore('playlists', { keyPath: 'id' });
                };
                req.onsuccess = e => {
                    this.instance = e.target.result;
                    this.loadAll();
                };
            },
            async save(data) {
                const tx = this.instance.transaction('playlists', 'readwrite');
                tx.objectStore('playlists').put(JSON.parse(JSON.stringify(data)));
                return new Promise(r => tx.oncomplete = r);
            },
            async delete(id) {
                const tx = this.instance.transaction('playlists', 'readwrite');
                tx.objectStore('playlists').delete(id);
                return new Promise(r => tx.oncomplete = r);
            },
            async loadAll() {
                const tx = this.instance.transaction('playlists', 'readonly');
                const req = tx.objectStore('playlists').getAll();
                req.onsuccess = () => {
                    AppState.playlists = req.result || [];
                    UI.renderPlaylists();
                };
            }
        };

        // --- ROUTING SYSTEM ---
        const Router = {
            go(view) {
                document.querySelectorAll('#app-root > div').forEach(div => div.classList.add('hidden'));
                document.getElementById('view-' + view).classList.remove('hidden');
                window.scrollTo(0,0);
            },
            openEditor(id) {
                this.go('editor');
                Editor.load(id);
            }
        };

        // --- UI ENGINE ---
        const UI = {
            toast(msg, type = 'success') {
                const id = 't-' + Date.now();
                const div = document.createElement('div');
                div.className = `px-8 py-4 rounded-2xl shadow-2xl text-white font-bold text-sm flex items-center gap-4 transition-all duration-500 translate-y-20 ${type === 'error' ? 'bg-red-600' : 'bg-fire-blue'}`;
                div.innerHTML = `<i class="fa-solid ${type === 'error' ? 'fa-circle-exclamation' : 'fa-circle-check'}"></i> ${msg}`;
                document.getElementById('toast-container').appendChild(div);
                setTimeout(() => div.classList.remove('translate-y-20'), 100);
                setTimeout(() => {
                    div.classList.add('opacity-0');
                    setTimeout(() => div.remove(), 500);
                }, 4000);
            },
            showModal(title, bodyHTML, onConfirm) {
                document.getElementById('modal-title').innerText = title;
                document.getElementById('modal-body').innerHTML = bodyHTML;
                document.getElementById('modal-confirm').onclick = onConfirm;
                document.getElementById('modal-overlay').classList.remove('hidden');
            },
            closeModal() {
                document.getElementById('modal-overlay').classList.add('hidden');
            },
            renderPlaylists() {
                const tbody = document.getElementById('pl-body');
                tbody.innerHTML = AppState.playlists.map(p => `
                    <tr>
                        <td class="font-black text-white">${p.name}</td>
                        <td class="font-bold text-gray-500">${p.channels.length}</td>
                        <td class="font-bold text-gray-500">${p.groups ? p.groups.length : 0}</td>
                        <td><span class="bg-green-500/10 text-green-500 px-3 py-1 rounded-full text-[10px] font-black">ACTIVE</span></td>
                        <td class="text-xs font-mono">2027-02-08</td>
                        <td>
                            <div class="flex gap-4">
                                <button onclick="Router.openEditor('${p.id}')" class="text-fire-blue hover:text-white"><i class="fa-solid fa-pen-to-square"></i></button>
                                <button onclick="IO.deletePlaylist('${p.id}')" class="text-gray-700 hover:text-red-500"><i class="fa-solid fa-trash-can"></i></button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }
        };

        // --- EDITOR MASTER LOGIC ---
        const Editor = {
            load(id) {
                AppState.currentPL = AppState.playlists.find(p => p.id === id);
                if(!AppState.currentPL) return;
                
                document.getElementById('active-pl-name').innerText = `Playlist: ${AppState.currentPL.name}`;
                
                // Extrair Grupos se não existirem
                if(!AppState.currentPL.groups) {
                    const uniqueGroups = [...new Set(AppState.currentPL.channels.map(c => c.group))];
                    AppState.currentPL.groups = uniqueGroups.map(name => ({ name, id: Math.random().toString(36).substr(2,5) }));
                }

                AppState.currentGroup = AppState.currentPL.groups[0]?.name;
                this.renderGroups();
                this.renderChannels();
            },

            renderGroups() {
                const container = document.getElementById('list-groups');
                document.getElementById('count-groups').innerText = AppState.currentPL.groups.length;

                container.innerHTML = AppState.currentPL.groups.map(g => {
                    const isActive = g.name === AppState.currentGroup;
                    const count = AppState.currentPL.channels.filter(c => c.group === g.name).length;
                    return `
                        <div onclick="Editor.selectGroup('${g.name}')" class="p-3 rounded-xl cursor-pointer flex justify-between items-center transition-all ${isActive ? 'bg-fire-blue text-white font-bold' : 'text-gray-500 hover:bg-white/5'}">
                            <span class="text-xs truncate pr-4">${g.name}</span>
                            <span class="text-[9px] font-black bg-black/30 px-2 py-0.5 rounded-full">${count}</span>
                        </div>
                    `;
                }).join('');
            },

            selectGroup(name) {
                AppState.currentGroup = name;
                this.renderGroups();
                this.renderChannels();
            },

            renderChannels() {
                const tbody = document.getElementById('list-channels');
                const search = document.getElementById('ch-search').value.toLowerCase();

                const filtered = AppState.currentPL.channels.filter(c => 
                    c.group === AppState.currentGroup && 
                    c.name.toLowerCase().includes(search)
                );

                tbody.innerHTML = filtered.map((c, idx) => `
                    <tr onclick="Editor.editChannel('${c.id}')" class="${AppState.editingChannel?.id === c.id ? 'active-row' : ''}">
                        <td><input type="checkbox" onclick="event.stopPropagation()"></td>
                        <td><img src="${c.logo}" class="w-8 h-8 object-contain rounded bg-black/40" onerror="this.src='https://via.placeholder.com/40?text=TV'"></td>
                        <td class="font-bold text-gray-200">${c.name}</td>
                        <td class="text-xs text-gray-500 font-mono">${c.epg || '---'}</td>
                        <td class="text-gray-700 text-[10px]">#${idx+1}</td>
                    </tr>
                `).join('');
            },

            editChannel(id) {
                const channel = AppState.currentPL.channels.find(c => c.id === id);
                AppState.editingChannel = channel;
                
                document.getElementById('empty-state-prop').classList.add('hidden');
                document.getElementById('prop-form').classList.remove('hidden');

                document.getElementById('attr-name').value = channel.name;
                document.getElementById('attr-logo').value = channel.logo;
                document.getElementById('attr-epg').value = channel.epg;
                document.getElementById('attr-url').value = channel.url;
                document.getElementById('logo-preview').innerHTML = `<img src="${channel.logo}" class="w-full h-full object-contain">`;

                this.renderChannels();
            },

            saveChanges() {
                if(!AppState.editingChannel) return;
                
                AppState.editingChannel.name = document.getElementById('attr-name').value;
                AppState.editingChannel.logo = document.getElementById('attr-logo').value;
                AppState.editingChannel.epg = document.getElementById('attr-epg').value;

                DB.save(AppState.currentPL);
                UI.toast("Channel attributes updated successfully!");
                this.renderChannels();
            }
        };

        // --- IO (M3U ENGINE) ---
        const IO = {
            importPrompt() {
                const html = `
                    <div class="space-y-6">
                        <div>
                            <label class="text-[10px] font-black text-gray-500 uppercase block mb-2">Playlist Label</label>
                            <input type="text" id="m3u-name" class="w-full bg-black/40 border border-white/5 p-4 rounded-2xl text-white outline-none focus:border-fire-blue" placeholder="Ex: Global Premium">
                        </div>
                        <div>
                            <label class="text-[10px] font-black text-gray-500 uppercase block mb-2">Source URL (M3U)</label>
                            <input type="text" id="m3u-url" class="w-full bg-black/40 border border-white/5 p-4 rounded-2xl text-white outline-none focus:border-fire-blue" placeholder="http://server.com:80/get.php...">
                        </div>
                    </div>
                `;
                UI.showModal("Import New Source", html, () => this.handleImport());
            },

            async handleImport() {
                const name = document.getElementById('m3u-name').value;
                const url = document.getElementById('m3u-url').value;
                if(!name || !url) return UI.toast("Missing required fields", "error");

                UI.toast("Connecting to source...", "info");
                UI.closeModal();

                try {
                    const proxy = `https://geminitv-proxy.jcdoni.workers.dev/?url=${encodeURIComponent(url)}`;
                    const res = await fetch(proxy);
                    const text = await res.text();
                    
                    if(!text.includes('#EXTM3U')) throw new Error("Format not recognized as M3U");

                    const channels = [];
                    const lines = text.split('\n');
                    for(let i=0; i<lines.length; i++) {
                        if(lines[i].startsWith('#EXTINF:')) {
                            const meta = lines[i];
                            const stream = lines[i+1]?.trim() || "";
                            const chName = meta.split(',')[1]?.trim() || "Unknown Channel";
                            const group = (meta.match(/group-title="([^"]+)"/) || ["","General"])[1];
                            const logo = (meta.match(/tvg-logo="([^"]+)"/) || ["",""])[1];
                            const epg = (meta.match(/tvg-id="([^"]+)"/) || ["",""])[1];

                            channels.push({
                                id: Math.random().toString(36).substr(2, 9),
                                name: chName, group, logo, epg, url: stream
                            });
                        }
                    }

                    const pl = { id: Date.now().toString(), name, source: url, channels };
                    await DB.save(pl);
                    await DB.loadAll();
                    UI.toast(`Successfully imported ${channels.length} entries!`);

                } catch(e) {
                    UI.toast("Import failed: " + e.message, "error");
                }
            }
        };

        // --- SCROLL REVEAL OBSERVER ---
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if(entry.isIntersecting) entry.target.classList.add('active');
            });
        }, { threshold: 0.1 });

        // INITIALIZATION
        window.onload = () => {
            DB.init();
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        };
    </script>
</body>
</html>
