<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini TV | Manual do Editor Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root { --accent: #22d3ee; --bg: #09090b; --row-bg: #18181b; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #e4e4e7; overflow: hidden; height: 100vh; }

        /* Estilo Slim para Edição Massiva */
        .slim-row { height: 42px; border-bottom: 1px solid #27272a; transition: background 0.15s; }
        .slim-row:hover { background: #27272a; }
        .slim-row input { background: transparent; border: none; font-size: 13px; width: 100%; color: #fafafa; }
        .slim-row input:focus { color: var(--accent); outline: none; }

        .sidebar-panel { width: 300px; background: #0c0c0e; border-right: 1px solid #1f1f23; }
        .active-view { display: flex !important; }

        /* Status Pills */
        .pill { padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .pill-vod { background: #450a0a; color: #f87171; }
        .pill-live { background: #064e3b; color: #34d399; }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="h-14 border-b border-zinc-800 flex items-center justify-between px-6 bg-zinc-950/80 backdrop-blur">
        <div class="flex items-center space-x-4">
            <span class="font-black text-cyan-500 tracking-tighter text-xl">GEMINI TV</span>
            <div class="h-4 w-[1px] bg-zinc-700"></div>
            <nav class="flex space-x-6 text-xs font-bold uppercase tracking-widest text-zinc-500">
                <button onclick="showView('home')" class="hover:text-cyan-400">Início</button>
                <button onclick="showView('editor')" class="hover:text-cyan-400">Editor</button>
                <button onclick="showView('config')" class="hover:text-cyan-400">Sincronização</button>
            </nav>
        </div>
        <div class="flex items-center space-x-4 text-[10px] font-mono text-zinc-500">
            <span>MOTOR: <b class="text-green-500">PRONTO</b></span>
            <span>DNA: <b class="text-cyan-500">V4.0</b></span>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <aside class="sidebar-panel p-6 flex flex-col space-y-6 overflow-y-auto">
            <div>
                <h3 class="text-[10px] font-black text-zinc-500 uppercase tracking-[2px] mb-4">Comandos de Extração</h3>
                <div class="space-y-2">
                    <button onclick="syncAll()" class="w-full text-left p-3 rounded-lg bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 text-xs flex items-center">
                        <i class="fa-solid fa-sync mr-3 text-cyan-500"></i> SINCRONIZAR TUDO
                    </button>
                    <button onclick="promptUrl()" class="w-full text-left p-3 rounded-lg bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 text-xs flex items-center">
                        <i class="fa-solid fa-plus mr-3 text-green-500"></i> EXTRAIR REPOSITÓRIO
                    </button>
                    <button onclick="scannerGithub()" class="w-full text-left p-3 rounded-lg bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 text-xs flex items-center">
                        <i class="fa-brands fa-github mr-3 text-white"></i> SCANNER GITHUB
                    </button>
                </div>
            </div>

            <div>
                <h3 class="text-[10px] font-black text-zinc-500 uppercase tracking-[2px] mb-4">Módulo Cleaner</h3>
                <div class="space-y-2">
                    <button onclick="runManualCleaner()" class="w-full text-left p-3 rounded-lg bg-cyan-900/20 hover:bg-cyan-900/40 border border-cyan-800/30 text-xs flex items-center text-cyan-400">
                        <i class="fa-solid fa-wand-sparkles mr-3"></i> WHITELIST & TAG KILLER
                    </button>
                    <button onclick="removeVOD()" class="w-full text-left p-3 rounded-lg bg-red-900/20 hover:bg-red-900/40 border border-red-800/30 text-xs flex items-center text-red-400">
                        <i class="fa-solid fa-filter-circle-xmark mr-3"></i> EXTERMÍNIO VOD
                    </button>
                </div>
            </div>

            <div class="flex-1"></div>

            <button onclick="sendToGithub()" class="w-full bg-white text-black p-3 rounded-lg font-bold text-xs hover:bg-cyan-500 hover:text-white transition-all">
                ENVIAR PARA GITHUB (LIVE)
            </button>
        </aside>

        <main class="flex-1 flex flex-col bg-zinc-950">
            
            <section id="view-editor" class="hidden flex-1 flex flex-col active-view">
                <div class="p-4 border-b border-zinc-900 flex justify-between items-center bg-zinc-900/20">
                    <div class="flex space-x-2">
                        <input type="text" id="filterInput" onkeyup="filterTable()" placeholder="Filtrar por nome ou grupo..." class="bg-zinc-900 border border-zinc-800 rounded px-4 py-2 text-xs w-64 focus:border-cyan-500 outline-none">
                        <button onclick="renameInMass()" class="px-4 py-2 bg-zinc-800 rounded text-xs hover:bg-zinc-700">Renomear Massa</button>
                    </div>
                    <div id="counter" class="text-[10px] font-bold text-zinc-500 uppercase">CANAIS: 0</div>
                </div>

                <div class="flex-1 overflow-auto custom-scrollbar">
                    <table class="w-full border-collapse">
                        <thead class="sticky top-0 bg-zinc-950 z-10">
                            <tr class="text-[10px] text-zinc-600 uppercase tracking-widest text-left">
                                <th class="p-3 w-10 text-center"><input type="checkbox"></th>
                                <th class="p-3 w-12">LOGO</th>
                                <th class="p-3">NOME DO CANAL</th>
                                <th class="p-3 w-48">CATEGORIA</th>
                                <th class="p-3 w-64">EPG ID (.BRASIL.)</th>
                                <th class="p-3 w-16">TIPO</th>
                            </tr>
                        </thead>
                        <tbody id="canal-list">
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="view-home" class="hidden flex-1 p-12 space-y-8">
                <div>
                    <h1 class="text-4xl font-black mb-2">Editor de Elite</h1>
                    <p class="text-zinc-500">Gestão de listas M3U com Protocolo DNA v4.0.</p>
                </div>
                <div class="grid grid-cols-3 gap-6">
                    <div class="p-8 rounded-2xl bg-zinc-900 border border-zinc-800">
                        <div class="text-xs text-zinc-500 uppercase font-bold mb-2">Total na Base</div>
                        <div id="stat-total" class="text-5xl font-black">0</div>
                    </div>
                    <div class="p-8 rounded-2xl bg-cyan-950/20 border border-cyan-900/30">
                        <div class="text-xs text-cyan-500 uppercase font-bold mb-2">Sincronizados</div>
                        <div id="stat-sync" class="text-5xl font-black text-cyan-500">0</div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        let baseCanais = [];
        let tagKillerList = ['FHD', '4K', 'RAW', '1080P', '60FPS', 'SD', 'HD', 'BR:', 'PT|', '[H265]'];

        function showView(id) {
            document.querySelectorAll('section').forEach(s => s.classList.remove('active-view'));
            document.getElementById('view-' + id).classList.add('active-view');
        }

        async function promptUrl() {
            const url = prompt("URL do Repositório/Lista:");
            if (url) importList(url);
        }

        async function importList(url) {
            try {
                const res = await fetch(`https://geminitv-proxy.jcdoni.workers.dev/?url=${encodeURIComponent(url)}`);
                const data = await res.text();
                processarM3U(data);
                showView('editor');
            } catch (e) { alert("Falha no Motor de Extração."); }
        }

        function processarM3U(text) {
            const lines = text.split('\n');
            lines.forEach(l => {
                if(l.startsWith('#EXTINF:')) {
                    const nameRaw = l.split(',')[1] || "Sem Nome";
                    const group = l.match(/group-title="([^"]+)"/);
                    const epg = l.match(/tvg-id="([^"]+)"/);
                    const logo = l.match(/tvg-logo="([^"]+)"/);
                    
                    // APLICAÇÃO AUTOMÁTICA DO MANUAL DO EDITOR NA IMPORTAÇÃO
                    let nomeLimpo = normalizarTexto(nameRaw);
                    nomeLimpo = aplicarTagKiller(nomeLimpo);
                    
                    const canal = {
                        id: Math.random().toString(36).substr(2, 9),
                        nome: nomeLimpo,
                        grupo: group ? group[1].toUpperCase() : "GERAL",
                        epg: epg ? epg[1] : nomeLimpo.replace(/\s+/g, '') + ".BRASIL.",
                        logo: logo ? logo[1] : "",
                        isVod: checkVod(nomeLimpo, group ? group[1] : "")
                    };
                    baseCanais.push(canal);
                }
            });
            renderTable();
        }

        function normalizarTexto(t) {
            return t.normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();
        }

        function aplicarTagKiller(t) {
            let temp = t;
            tagKillerList.forEach(tag => {
                const regex = new RegExp(tag, 'gi');
                temp = temp.replace(regex, '');
            });
            // Whitelist Radical: Apenas A-Z, 0-9 e espaços simples
            return temp.replace(/[^a-zA-Z0-9 ]/g, "").replace(/\s+/g, ' ').trim();
        }

        function checkVod(nome, grupo) {
            const padraoVod = /S\d+E\d+|Temporada|Episodio|Filme/gi;
            return padraoVod.test(nome) || padraoVod.test(grupo);
        }

        function renderTable() {
            const body = document.getElementById('canal-list');
            body.innerHTML = baseCanais.map((c, i) => `
                <tr class="slim-row ${c.isVod ? 'opacity-40' : ''}">
                    <td class="p-3 text-center"><input type="checkbox" class="accent-cyan-500"></td>
                    <td class="p-3"><img src="${c.logo}" class="w-6 h-6 object-contain rounded bg-zinc-900" onerror="this.src='https://via.placeholder.com/24'"></td>
                    <td class="p-3"><input type="text" value="${c.nome}" onblur="baseCanais[${i}].nome = this.value"></td>
                    <td class="p-3"><input type="text" value="${c.grupo}" class="text-zinc-500 font-bold" onblur="baseCanais[${i}].grupo = this.value"></td>
                    <td class="p-3"><input type="text" value="${c.epg}" class="font-mono text-cyan-600" onblur="baseCanais[${i}].epg = this.value"></td>
                    <td class="p-3">
                        <span class="pill ${c.isVod ? 'pill-vod' : 'pill-live'}">${c.isVod ? 'VOD' : 'LIVE'}</span>
                    </td>
                </tr>
            `).join('');
            document.getElementById('counter').innerText = `CANAIS: ${baseCanais.length}`;
            document.getElementById('stat-total').innerText = baseCanais.length;
        }

        function removeVOD() {
            baseCanais = baseCanais.filter(c => !c.isVod);
            renderTable();
        }

        function renameInMass() {
            const de = prompt("Renomear qual categoria?");
            const para = prompt("Para qual nome?");
            if (de && para) {
                baseCanais.forEach(c => { if(c.grupo === de.toUpperCase()) c.grupo = para.toUpperCase(); });
                renderTable();
            }
        }

        function filterTable() {
            const q = document.getElementById('filterInput').value.toLowerCase();
            const rows = document.querySelectorAll('.slim-row');
            rows.forEach((row, i) => {
                const text = baseCanais[i].nome.toLowerCase() + baseCanais[i].grupo.toLowerCase();
                row.style.display = text.includes(q) ? '' : 'none';
            });
        }

        window.onload = () => showView('home');
    </script>
</body>
</html>
