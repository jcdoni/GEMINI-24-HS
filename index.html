<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini TV | Enterprise Manager 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');
        
        :root {
            --accent: #00a8e1;
            --bg-dark: #0f171e;
            --card-bg: #1a242f;
            --slim-border: rgba(255,255,255,0.05);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            margin: 0;
            overflow: hidden;
            height: 100vh;
        }

        /* Glassmorphism para o Dropdown e Nav */
        .glass-ui {
            background: rgba(15, 23, 30, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Linhas Slim para Edição Massiva */
        .row-slim {
            height: 42px;
            border-bottom: 1px solid var(--slim-border);
            display: flex;
            align-items: center;
            padding: 0 1rem;
            transition: all 0.2s;
        }
        .row-slim:hover { background: rgba(255,255,255,0.03); }

        /* Cards do Theater Mode */
        .card-theater {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-theater:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 10px 30px rgba(0, 168, 225, 0.2);
        }

        /* Scroll Customizado */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

        .hidden { display: none !important; }
        .active-view { display: flex !important; }

        /* Dropdown Style */
        .dropdown:hover .dropdown-menu { display: block; }
    </style>
</head>
<body class="flex flex-col">

    <nav class="h-20 glass-ui flex items-center justify-between px-10 z-50">
        <div class="flex items-center space-x-12">
            <div class="text-2xl font-black tracking-tighter cursor-pointer" onclick="navigateTo('home')">
                GEMINI<span class="text-cyan-500">TV</span>
            </div>
            <div class="flex space-x-8 text-xs font-bold uppercase tracking-[2px] text-gray-400">
                <button onclick="navigateTo('home')" id="nav-home" class="hover:text-white transition-colors">Início</button>
                <button onclick="navigateTo('database')" id="nav-database" class="hover:text-white transition-colors">Projetos</button>
                <button onclick="navigateTo('editor')" id="nav-editor" class="hover:text-white transition-colors">Editor Profissional</button>
            </div>
        </div>

        <div class="flex items-center space-x-4">
            <div class="relative dropdown">
                <button class="bg-white text-black px-6 py-2 rounded-full font-bold text-xs flex items-center">
                    IMPORTAR LISTA <i class="fa-solid fa-chevron-down ml-2"></i>
                </button>
                <div class="dropdown-menu hidden absolute right-0 mt-2 w-56 glass-ui rounded-xl overflow-hidden shadow-2xl">
                    <button onclick="importFlow('m3u')" class="w-full text-left p-4 hover:bg-white/10 text-xs font-bold border-b border-white/5"><i class="fa-solid fa-sync mr-2 text-cyan-500"></i> SYNC M3U / LINK</button>
                    <button onclick="importFlow('xtream')" class="w-full text-left p-4 hover:bg-white/10 text-xs font-bold border-b border-white/5"><i class="fa-solid fa-link mr-2 text-green-500"></i> EXTRAIR XTREAM</button>
                    <button onclick="importFlow('scanner')" class="w-full text-left p-4 hover:bg-white/10 text-xs font-bold"><i class="fa-brands fa-github mr-2 text-white"></i> SCANNER USER</button>
                </div>
            </div>
            <button onclick="exportarM3U()" class="bg-zinc-800 text-white px-6 py-2 rounded-full font-bold text-xs hover:bg-zinc-700">EXPORTAR</button>
            <i class="fa-solid fa-gear text-gray-500 cursor-pointer hover:text-white text-lg px-2"></i>
        </div>
    </nav>

    <main id="app-container" class="flex-1 overflow-y-auto p-10">
        
        <section id="page-home" class="flex-col active-view">
            <div class="grid grid-cols-4 gap-6 mb-12">
                <div class="p-6 glass-ui rounded-2xl">
                    <p class="text-[10px] font-bold text-gray-500 uppercase">Canais na Base</p>
                    <h3 class="text-4xl font-black mt-2" id="stat-total">0</h3>
                </div>
                <div class="p-6 glass-ui rounded-2xl border-l-4 border-cyan-500">
                    <p class="text-[10px] font-bold text-gray-500 uppercase">Acervo VOD</p>
                    <h3 class="text-4xl font-black mt-2 text-cyan-400" id="stat-vod">0</h3>
                </div>
                <div class="p-6 glass-ui rounded-2xl">
                    <p class="text-[10px] font-bold text-gray-500 uppercase">Status do Motor</p>
                    <h3 class="text-xl font-black mt-2 text-green-500">OPERACIONAL</h3>
                </div>
            </div>

            <h3 class="text-xs font-black text-gray-500 uppercase tracking-widest mb-6">Conteúdo VOD (Acervo Separado)</h3>
            <div id="vod-container" class="grid grid-cols-5 gap-6">
                <p class="text-gray-600 italic col-span-5">Nenhum VOD detectado na base.</p>
            </div>
        </section>

        <section id="page-database" class="flex-col hidden">
            <h2 class="text-3xl font-bold mb-8 italic">Gerenciador de Fontes</h2>
            <div id="project-list" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                </div>
        </section>

        <section id="page-editor" class="flex-col hidden h-full">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center space-x-4">
                    <h2 class="text-2xl font-bold">Painel de Edição</h2>
                    <div class="flex bg-black/40 rounded-lg p-1">
                        <button onclick="setView('slim')" id="btn-slim" class="px-4 py-1 text-[10px] font-bold rounded bg-zinc-800">SLIM</button>
                        <button onclick="setView('theater')" id="btn-theater" class="px-4 py-1 text-[10px] font-bold rounded">THEATER</button>
                    </div>
                </div>
                
                <div class="flex space-x-2">
                    <button onclick="runWhitelist()" class="px-3 py-2 glass-ui rounded text-[10px] font-bold hover:text-cyan-400">WHITELIST RADICAL</button>
                    <button onclick="runTagKiller()" class="px-3 py-2 glass-ui rounded text-[10px] font-bold hover:text-cyan-400">TAG KILLER</button>
                    <button onclick="renameGroup()" class="px-3 py-2 glass-ui rounded text-[10px] font-bold hover:text-cyan-400">RENAME GROUP</button>
                    <button onclick="cleanMass()" class="px-3 py-2 bg-red-900/20 text-red-500 rounded text-[10px] font-bold border border-red-900/30">CLEAN</button>
                </div>
            </div>

            <div id="editor-content" class="flex-1 overflow-auto border border-white/5 rounded-xl bg-black/20">
                </div>
        </section>
    </main>

    <script>
        let db = JSON.parse(localStorage.getItem('gemini_v5_db')) || [];
        let canaisAtivos = [];
        let vodAtivos = [];
        let viewMode = 'slim'; // slim ou theater

        function navigateTo(pageId) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById('page-' + pageId).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('text-cyan-500', 'border-b-2', 'border-cyan-500'));
            document.getElementById('nav-' + pageId).classList.add('text-cyan-500', 'border-b-2', 'border-cyan-500');
            
            if(pageId === 'home') renderHome();
            if(pageId === 'database') renderDatabase();
        }

        function setView(mode) {
            viewMode = mode;
            document.getElementById('btn-slim').classList.toggle('bg-zinc-800', mode === 'slim');
            document.getElementById('btn-theater').classList.toggle('bg-zinc-800', mode === 'theater');
            renderEditor();
        }

        async function importFlow(type) {
            const url = prompt(`Digite a URL para ${type.toUpperCase()}:`);
            if (!url) return;

            try {
                const res = await fetch(`https://geminitv-proxy.jcdoni.workers.dev/?url=${encodeURIComponent(url)}`);
                const data = await res.text();
                processData(data, url);
            } catch (e) { alert("Erro na sincronização."); }
        }

        function processData(text, url) {
            const lines = text.split('\n');
            let tempCanais = [];
            let tempVod = [];
            
            lines.forEach(l => {
                if(l.startsWith('#EXTINF:')) {
                    const nameRaw = l.split(',')[1] || "Sem Nome";
                    const isVod = /S\d+E\d+|Temporada|Episodio|Filme/gi.test(nameRaw);
                    
                    const obj = {
                        id: Math.random().toString(36).substr(2, 9),
                        nome: nameRaw.trim(),
                        grupo: (l.match(/group-title="([^"]+)"/) || ["","GERAL"])[1].toUpperCase(),
                        logo: (l.match(/tvg-logo="([^"]+)"/) || ["",""])[1],
                        epg: (l.match(/tvg-id="([^"]+)"/) || ["",""])[1],
                        oculto: false
                    };

                    if(isVod) tempVod.push(obj); else tempCanais.push(obj);
                }
            });

            canaisAtivos = tempCanais;
            vodAtivos = tempVod;
            db.push({ id: Date.now(), name: "Importado "+new Date().toLocaleDateString(), canais: tempCanais, vod: tempVod, url });
            save();
            navigateTo('editor');
            renderEditor();
        }

        function renderEditor() {
            const container = document.getElementById('editor-content');
            if (viewMode === 'slim') {
                container.innerHTML = `
                    <table class="w-full text-left text-[11px]">
                        <thead class="sticky top-0 bg-zinc-900 text-gray-500 uppercase">
                            <tr>
                                <th class="p-3 w-10"></th>
                                <th class="p-3">LOGO</th>
                                <th class="p-3">NOME DO CANAL</th>
                                <th class="p-3">GRUPO</th>
                                <th class="p-3">DNA EPG</th>
                                <th class="p-3 w-10 text-center"><i class="fa-solid fa-eye"></i></th>
                            </tr>
                        </thead>
                        <tbody>
                            ${canaisAtivos.map((c, i) => `
                                <tr class="row-slim ${c.oculto ? 'opacity-30' : ''}">
                                    <td class="p-2"><input type="checkbox"></td>
                                    <td class="p-2"><img src="${c.logo}" class="w-6 h-6 object-contain rounded"></td>
                                    <td class="p-2 font-bold"><input type="text" value="${c.nome}" class="bg-transparent border-none outline-none w-full" onblur="canaisAtivos[${i}].nome=this.value"></td>
                                    <td class="p-2 text-gray-500 uppercase">${c.grupo}</td>
                                    <td class="p-2 text-cyan-500/50 font-mono">${c.epg || c.nome.replace(/\s+/g,'')+'.BRASIL.'}</td>
                                    <td class="p-2 text-center">
                                        <i class="fa-solid ${c.oculto ? 'fa-eye-slash text-red-500' : 'fa-eye text-cyan-500'} cursor-pointer" onclick="toggleOculto(${i})"></i>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>`;
            } else {
                // THEATER MODE (CARDS)
                container.innerHTML = `<div class="p-6 grid grid-cols-4 gap-6">
                    ${canaisAtivos.map((c, i) => `
                        <div class="card-theater flex flex-col items-center relative ${c.oculto ? 'opacity-30' : ''}">
                            <div class="absolute top-2 right-2" onclick="toggleOculto(${i})"><i class="fa-solid ${c.oculto ? 'fa-eye-slash text-red-500' : 'fa-eye text-gray-600'}"></i></div>
                            <img src="${c.logo}" class="w-20 h-20 object-contain mb-4">
                            <h4 class="text-sm font-bold truncate w-full text-center">${c.nome}</h4>
                            <div class="mt-2 w-full bg-black/40 p-2 rounded text-[9px] font-mono text-cyan-400">
                                <p class="text-[7px] text-gray-500 mb-1">PROGRAMAÇÃO EPG:</p>
                                AGUARDANDO EPG .BRASIL.
                            </div>
                        </div>
                    `).join('')}
                </div>`;
            }
        }

        function toggleOculto(index) {
            canaisAtivos[index].oculto = !canaisAtivos[index].oculto;
            renderEditor();
        }

        // FUNÇÕES DO MANUAL
        function runWhitelist() {
            canaisAtivos.forEach(c => {
                c.nome = c.nome.normalize("NFD").replace(/[\u0300-\u036f]/g, "") // Normalização
                         .replace(/[^a-zA-Z0-9 ]/g, "").replace(/\s+/g, ' ').trim(); // Whitelist
            });
            renderEditor();
        }

        function runTagKiller() {
            const tags = ['FHD', '4K', 'RAW', '1080P', '60FPS', 'SD', 'HD', 'BR:', 'PT|'];
            canaisAtivos.forEach(c => {
                tags.forEach(t => {
                    const regex = new RegExp(t, 'gi');
                    c.nome = c.nome.replace(regex, '').trim();
                });
            });
            renderEditor();
        }

        function renameGroup() {
            const de = prompt("Renomear qual grupo?");
            const para = prompt("Para qual nome?");
            if(de && para) {
                canaisAtivos.forEach(c => { if(c.grupo === de.toUpperCase()) c.grupo = para.toUpperCase(); });
                renderEditor();
            }
        }

        function save() { localStorage.setItem('gemini_v5_db', JSON.stringify(db)); }

        function renderHome() {
            document.getElementById('stat-total').innerText = db.reduce((a, b) => a + b.canais.length, 0);
            document.getElementById('stat-vod').innerText = db.reduce((a, b) => a + b.vod.length, 0);
            const vodContainer = document.getElementById('vod-container');
            const todosVods = db.flatMap(p => p.vod);
            if(todosVods.length > 0) {
                vodContainer.innerHTML = todosVods.slice(0, 10).map(v => `
                    <div class="card-theater text-center">
                        <div class="h-40 bg-zinc-800 rounded-lg mb-2 flex items-center justify-center">
                            <i class="fa-solid fa-film text-3xl text-zinc-700"></i>
                        </div>
                        <p class="text-[10px] font-bold truncate">${v.nome}</p>
                    </div>
                `).join('');
            }
        }

        window.onload = () => navigateTo('home');
    </script>
</body>
</html>
